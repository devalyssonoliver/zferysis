unit frmLocalizacaoColaborador;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
  System.Classes, Vcl.Graphics, Vcl.Controls, Vcl.Forms, Vcl.Dialogs,
  Vcl.ExtCtrls, Vcl.StdCtrls, Data.DB, Vcl.Grids, Vcl.DBGrids,
  Vcl.WinXCtrls, dmColaboradorLoc, System.ImageList, Vcl.ImgList, uFuncoes;

type
  TCriterioPesquisa = (cpCodigo, cpNome, cpMatricula);

  TForm_Loc_Colaborador = class(TForm)
    pnlGrid: TPanel;
    lbTitulo: TLabel;
    Panel1: TPanel;
    cmbCriteriosdePesquisa: TComboBox;
    edtPesquisarCodigo: TEdit;
    edtPesquisarNome: TEdit;
    edtPesquisarMatricula: TEdit;
    pnlBotoes: TPanel;
    dbGrid: TDBGrid;
    imgListAtivo: TImageList;
    pnlListTop: TPanel;
    Panel2: TPanel;
    Label1: TLabel;
    tgsTodos: TToggleSwitch;
    btnNovo: TButton;
    btnExibir: TButton;
    btnFechar: TButton;
    btnRelatorio: TButton;
    dsColaboradorLoc: TDataSource;
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure BuscarPorCriterio(const Criterio: TCriterioPesquisa; const Valor: string);
    procedure cmbCriteriosdePesquisaSelect(Sender: TObject);
    procedure edtPesquisarCodigoExit(Sender: TObject);
    procedure edtPesquisarNomeExit(Sender: TObject);
    procedure edtPesquisarMatriculaExit(Sender: TObject);
    procedure TratarCampoPesquisa(Sender: TObject; Criterio: TCriterioPesquisa);
  private
    FColaboradorLocDM: TColaboradorLocDataModule;
  end;

var
  Form_Loc_Colaborador: TForm_Loc_Colaborador;

implementation

{$R *.dfm}

procedure TForm_Loc_Colaborador.FormCreate(Sender: TObject);
begin
     FColaboradorLocDM  := TColaboradorLocDataModule.Create(nil);
    if Assigned(FColaboradorLocDM) then
        begin
        dsColaboradorLoc.DataSet := FColaboradorLocDM.fdqryColaboradorLoc;
        dsColaboradorLoc.DataSet.Active := True;
        end

end;

procedure TForm_Loc_Colaborador.FormDestroy(Sender: TObject);
begin
  FreeAndNil(FColaboradorLocDM);
end;

procedure TForm_Loc_Colaborador.FormShow(Sender: TObject);
begin
  if Assigned(FColaboradorLocDM) and Assigned(FColaboradorLocDM.fdqryColaboradorLoc) then
    dsColaboradorLoc.DataSet := FColaboradorLocDM.fdqryColaboradorLoc

end;

procedure TForm_Loc_Colaborador.BuscarPorCriterio(const Criterio: TCriterioPesquisa; const Valor: string);
begin
  if not Assigned(FColaboradorLocDM) then
  begin
    Exit;
  end;

  if Trim(Valor) <> '' then
  begin
    try
      case Criterio of
        cpCodigo:    FColaboradorLocDM.Buscar('codigo', Valor);
        cpNome:      FColaboradorLocDM.Buscar('nome', Valor);
        cpMatricula: FColaboradorLocDM.Buscar('matricula', Valor);
      end;
    except
      on E: Exception do
        MsgBox('Erro!', E.Message, False, 2);
    end;
  end;
end;

procedure TForm_Loc_Colaborador.cmbCriteriosdePesquisaSelect(Sender: TObject);
begin
  edtPesquisarCodigo.Visible := cmbCriteriosdePesquisa.ItemIndex = Ord(cpCodigo);
  edtPesquisarNome.Visible := cmbCriteriosdePesquisa.ItemIndex = Ord(cpNome);
  edtPesquisarMatricula.Visible := cmbCriteriosdePesquisa.ItemIndex = Ord(cpMatricula);
end;

procedure TForm_Loc_Colaborador.TratarCampoPesquisa(Sender: TObject; Criterio: TCriterioPesquisa);
var
  EditField: TEdit;
begin
  EditField := TEdit(Sender);
  if verificarCampoPreenchido(EditField) then
  begin
    BuscarPorCriterio(Criterio, EditField.Text);
  end
  else
  begin
    dsColaboradorLoc.DataSet.Close;
  end;
end;

procedure TForm_Loc_Colaborador.edtPesquisarCodigoExit(Sender: TObject);
begin
  TratarCampoPesquisa(Sender, cpCodigo);
end;

procedure TForm_Loc_Colaborador.edtPesquisarNomeExit(Sender: TObject);
begin
  TratarCampoPesquisa(Sender, cpNome);
end;

procedure TForm_Loc_Colaborador.edtPesquisarMatriculaExit(Sender: TObject);
begin
  TratarCampoPesquisa(Sender, cpMatricula);
end;

end.

