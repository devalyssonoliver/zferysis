program FerySis;

uses
  System.SysUtils,
  Vcl.Forms,
  Conexao in '..\Classes\Conexao.pas',
  frmLogin in '..\Views\frmLogin.pas' {Frm_Login} ,
  frmPrincipal in '..\Views\frmPrincipal.pas' {Frm_Principal} ,
  dmGerenciadorConexao
    in '..\Models\dmGerenciadorConexao.pas' {GerenciadorConexao: TDataModule} ,
  Usuario in '..\Classes\Usuario.pas',
  dmUsuario in
    '..\Models\DataModules\dmUsuario.pas' {UsuarioDataModule: TDataModule} ,
  frmConfigurarBanco in '..\Views\frmConfigurarBanco.pas' {FrmConfigBanco} ,
  uArquivoIni in '..\Units\uArquivoIni.pas',
  uFuncoes in '..\Units\uFuncoes.pas',
  Colaborador in '..\Classes\Colaborador.pas',
  frmCadastroUsuario
    in '..\Views\FrmCadastro\frmCadastroUsuario.pas' {Frm_Cad_Usuario} ,
  frmLocalizacaoUsuario
    in '..\Views\FrmLocalização\frmLocalizacaoUsuario.pas' {Form_Loc_Usuarios} ,
  iUsuario in '..\Interfaces\iUsuario.pas',
  iUsuarioRepositorio in '..\Models\Repositórios\iUsuarioRepositorio.pas',
  iColaborador in '..\Interfaces\iColaborador.pas',
  iColaboradorRepositorio
    in '..\Models\Repositórios\iColaboradorRepositorio.pas',
  dmColaborador
    in '..\Models\DataModules\dmColaborador.pas' {ColaboradorDataModule: TDataModule} ,
  frmLocalizacaoColaborador
    in '..\Views\FrmLocalização\frmLocalizacaoColaborador.pas' {Form_Loc_Colaborador};

{$R *.res}

begin
  Application.Initialize;
  Application.MainFormOnTaskbar := True;

  // Criando os módulos de dados
  Application.CreateForm(TGerenciadorConexao, GerenciadorConexao);

  try

    if GerenciadorConexao.Conexao.ConectarAoBancoDeDados then
    begin

      Application.CreateForm(TFrm_Login, Frm_Login);
      if Assigned(Frm_Login) then
      begin
        Frm_Login.ShowModal;
      end
      else
        raise Exception.Create('Erro ao criar o formulário de login.');

      Frm_Login.Free;

      Application.CreateForm(TFrm_Principal, Frm_Principal);
      if Assigned(Frm_Principal) then
        Application.Run
      else
        raise Exception.Create('Erro ao criar o formulário principal.');
    end
    else
      raise Exception.Create('Não foi possível conectar ao banco.');

  except
    on E: Exception do
    begin

      Application.CreateForm(TFrmConfigBanco, FrmConfigBanco);
      if Assigned(FrmConfigBanco) then
        FrmConfigBanco.ShowModal
      else
        raise Exception.Create
          ('Erro ao criar o formulário de configuração de banco.');
    end;
  end;

end.
